---
title:  "R 기반 성향 점수 분석 - Introduction"
excerpt: "R 기반 성향 점수 분석 - 도입부"

categories: STAT

tags: [PSM, PSA, Propensity_score]

date: 2021-10-16
last_modified_at: 2021-10-16

toc: true
toc_sticky: true

---

## Chapter 1. 연구설계와 인과추론

### 1. 효과추정치 수계산

연구가설은 원인 변수($X$, cause variable)와 결과 변수 ($Y$, outcome variable)의 인과 관계로 제시된다.
흔히 '통제집단 포함 무작위배치 실험 (RCT, randomized controlled trial)'을 거치는 연구를 제외하고는 원인변수와 결과변수 사이의 관계가 '타당한 인과관계'라고 부를 수 있는 경우는 없다고 하는 것이 보통
**Internal validity**를 확보한 인과관계의 조건

1. 원인변수의 변화와 결과변수의 변화는 **서로 상관관계**를 갖는다.
2. 원인변수의 변화와 결과변수의 변화보다 **시간적으로 먼저** 발생한다.
3. 원인변수의 변화와 결과변수의 변화 사이의 상관관계를 설명할 수 있는 다른 요인들은 존재하지 않는다.  -- 특히, observation study에서 충족시키기 어렵다 (`confounder` 때문)

>**RCT**에서: 무작위 배치 (random assignment)를 통해 교란변수들로 인한 자기선택 편향을 제거
>**PSA**에서: 교란변수들을 활용해 개체가 처치집단에 배치될 확률을 의미하는 성향점수를 추정한 후 이를 모형화하여 무작위배치와 동등하거나 혹은 매우 유사한 상황을 창출

#### 필수용어 정리

- `원인 변수` `cause variable`: 연구자가 주장하고자 하는 인과관계에서 원인이 되는 사건의 발생 여부를 기록한 변수
  - `처치 집단` `treated group`: 원인이 되는 사건에 노출된 사례들
  - `통제 집단` `control group`: 원인이 되는 사건에 노출되지 않은, 혹은 원인이 되는 사건과 비교 가능한 다른 사건을 경험하거나 그 사건에 노출된 사례들
- `결과 변수` `outcome variable`: 결과가 되는 사건 혹은 속성의 수준을 측정한 변수
- `처치 효과` `treatment effect`: 다른 변수들의 효과를 통제하였을 때, 원인 사건이 발생하지 않았을 경우에 나타나는 결과 변수 기댓값 대비 원인 사건이 발생했을 경우 나타나는 결과 변수 기댓값의 차이
- `공변량` `covariate`: 원인 변수의 변화와 결과 변수의 변화와 연관 관계를 가질 것으로 기대되는 변수
- `실험연구 데이터` `experimental data`: 실험 조작과 무작위 배치, 두 가지 조건이 충족된 연구설계를 통해 수집한 데이터
  - `실험 조작` `experimental manipulation`: 연구자가 원인 변수의 수준을 조작, 통제할 수 있다.
  - `무작위 배치` `random assignment`: 원인 변수의 수준, 즉 처치 집단과 통제 집단에 배치될 확률이 동등하도록
- `관측 연구 데이터` `observational data`
  - `비 실험 연구 데이터` `non-experimental data`: 실험 조작과 무작위 배치 두 가지 조건 모두를 충족하지 못하는 데이터
  - `준 실험연구 데이터` `quasi-experimental data`: 무작위배치 조건은 충족하지만 실험조작 조건이 완전하게 충족되지 못하는 데이터

### 2. 루빈 인과모형: 잠재결과와 인과관계 추론

**대안사실 (counterfactual)** 혹은 **잠재결과 (potential outcome)**
: 어떤 원인이 되는 사건이 발생하지 않았다고 가정했을 때, 또는 반대로 발생할 수 있었으나 발생하지 않았던 사건이 발생했다고 가정했을 때, '존재하는 사실'이 어떻게 '대안적으로 다르게 존재하는 사실'이 될 수 있을 지를 표현
: '사실 (factual)' - 현재의 원인 변수의 값에 따라 존재하는 결과변수의 값
: '대안사실' - 원인 변수가 달라지면 존재할 수 있는 결과변수

- RCM 관점에서 보면 실현된 잠재변수는 관측값이지만 실현되지 않은 대안사실은 결측값이 된다.

대강: 동일한 사람에게서 얻은 2개의 잠재 결과값의 차이를 계산한다

#### ATT (Average treatment effect for treated)

$$ \tau^1=E(Y_i^1|T_i=1)\,-\,E(Y_i^0|T_i=1) $$

#### ATC (Average treatment effect for control)

$$ \tau^0=E(Y_i^1|T_i=0)\,-\,E(Y_i^0|T_i=0) $$

#### ATE (Average treatment effect)

$$ \tau=\pi\times\tau^1+(1-\pi)\times\tau^0 $$

주로 **ATT**를 분석하는 데 집중한다.
자기선택 편향을 일으키는 요인, 즉 공변량 $X$를 알고 있으며 측정할 수 있다고 가정
공변량을 하나의 차원으로 압축하여 표현한 점수를 사용
표본의 특정 개체가 원인처치를 받을 확률 $[e(X)=P(T=1|X)]$를 계산
공변량들을 이용해 특정 개체가 원인처치를 받을 확률을 추정: **성향점수** `propensity score`

$$ (Y^1, Y^0)\bot T|e(X),\,0<e(X)=prob(T=1|X)<1 $$

#### 성향점수의 가정

1) ITAA (무작위 배치화 가정, the ignorable treatment assignment assumption): 자기선택 편향을 발생시키는 공변량들의 조건에 따라 개체가 실험처치를 받을 확률은 두 가지 잠재결과와 독립
2) SUTVA (사례별 안정처치효과 가정, the stable unit treatment value assumption): 표본 내 어떤 개체가 원인처치에 노출되었을 때, 그 개체에 대한 원인처치 배치 메커니즘이 어떠하든, 그리고 그 개체 외의 다른 개체가 어떤 원인처치에 배치되든 그 개체의 잠재 결과는 동일
    - 사례에 미치는 효과가 동일하다.
    - 표본 내 개체들 사이의 상호작용이 존재하지 않는다.

#### 여러 이론적, 현실적 문제점

1) 모든 공변량을 모두 파악할 수 없다: 누락변수 편향 (omitted variable bias)
    - 민감도 분석 (sensitivity analysis)를 제안
2) 모형을 구성하는 사람에 따라 어떤 변수가 공변량인지 다르게 판단
3) 성향점수 추정 방법에 따라 성향점수분석 결과가 달라질 수 있음
4) 처치집단 사례들과 동일한 혹은 유사한 성향점수를 갖는 통제집단 사례들이 존재하지 않는 경우 - 분리/완전분리 (공통 지지 영역 `common support region`이 적음, 없음)

### 3. 공변량을 통제한 회귀분석 추정의 문제

원인변수는 외부에서 생성된 특성을 띠기 보다, 개체의 내적 특성에 따라 처치집단의 선택확률이 달라지는 내생성을 띤다.
처치집단과 통제집단의 공변량 수준이 다를 수 있다 - 모형의 설정방식에 따라 처치효과 추정치는 변할 가능성이 있다: 모형의존성

### 4. 성향점수분석의 진행절차
