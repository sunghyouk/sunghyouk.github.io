---
title:  "R 기반 성향 점수 분석 - 성향점수 추정"
excerpt: "R 기반 성향 점수 분석 - 성향점수 추정"

categories: STAT

tags: [PSM, PSA, Propensity_score]
use_math: true

date: 2021-10-23
last_modified_at: 2021-10-23

toc: true
toc_sticky: true

---

## Chapter 2. 성향점수 추정

`성향점수`  

1) 원인변수와 결과변수의 관계를 교란시키는 공변량 정보가 주어졌다고 가정할 때 표본의 개체가 처치집단에 배치될 확률을 의미  
2) 원인처치 배치 과정을 모형화하여 추정한 처치집단 배치확률  
3) 무작위배치가 적용된 실험연구의 원인처치 배치와 동등하도록 처치집단과 통제집단의 균형성을 맞추는데 사용

- 공변량이란 무엇인지  
- 일반화선형모형을 이용하여 성향점수를 추정  
- 공통지지영역 점검

### 1. 공변량 선정

원인처치가 발생한 이후에 측정 (매개변수) 된 것이 아니어야 한다.  
공변량이 아닌 변수들을 빼는 것

- 원인처치 배치과정과 결과변수 모두와 상관관계가 있는 공변량 변수들은 모두 포함
- 원인처치 배치과정과 결과변수 모두와 상관관계가 있더라도 처치효과를 매개하는 매개변수는 배제
- 매개변수는 성향점수를 추정할 때 절대 고려하면 안됨 - 매개변수를 공변량이라고 오해하지 말 것
- 원인처치 배정과정과 상관관계를 갖는 변수들 (원인변수 예측 변수들): 연구표본이 작은 경우 포함시키지 말 것
  - 검증력이 감소할 위험
- 결과변수와 상관관계를 갖는 변수들 (결과변수 예측변수들): 성향점수 추정과정에 포함시키는 것이 낫다.
  - 검증력을 높일 수 있음

하지만, 현실 데이터에 곧바로 적용하기가 쉽지 않다...  

### 2. GLM 기반 성향점수 추정

기계학습 기법을 사용할 수 있으나, 여기서는  
R base의 `glm()`, `ggplot2`를 이용해 시각화를 하겠다.  

*cf)* vscode에서 R 사용 시 `command + enter`로 line by line execution  

```R
# GLM, 로지스틱 회귀모형을 이용한 성향점수 추정
logis_ps <- glm(treat ~ V1 + V2 + V3, data = mydata,
               family = binomial(link = "logit"))
summary(logis_ps)
```

`treat`: 원인변수
`V1, V2, V3`: 공변량  

로지스틱 함수를 통과한 확률값보다 통과 전 선형 로짓 형태의 수치를 쓰는 것이 더 좋다.  

```R
mydata$ps_logit <- predict(logis_ps, mydata,
                          type = "link")  # 로짓
```

선형로짓 형태의 성향점수와 추정확률 형태의 성향점수 분포를 히스토그램을 통해 비교  

### 3. 공통지지영역 점검

성향점수 추정 후 처치집단의 성향점수와 통제집단의 성향점수가 얼마나 겹쳐지는지 (overlapped) - `common support region`  
분리 현상 (separation)이 나타나면 두 집단은 서로 비교될 수 없음  
이는 히스토그램과 박스 플롯을 이용할 수 있음

*cf)* 하지만, `MatchIt`, `cobalt` 패키지를 이용하면 성향 점수 추정, 공통 지지 영역 확인 과정이 대폭 축소됨  

## Chapter 3. 성향점수분석 기법 실습을 위한 R 패키지

1. 연구 설계
2. 데이터 전처리 - `tidyverse`, `Zelig`, `nnet`, `Hmisc`
3. 성향점수 추정 - `MatchIt`
4. 성향점수 분석 - `MatchIt`
5. 균형성 점검 - `cobalt`
6. 처치효과 추정 - `tidyverse`, `Zelig`, `nnet`, `Hmisc`
7. 민감도 분석 - `treatSens`, `sensitivitymw`, `sensitivityfull`
